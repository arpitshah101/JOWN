<?xml version="1.0" encoding="UTF-8"?>
<jown>
	<workflow name="SPN Workflow">
		<groups>
			<group>Student</group>
			<group>Instructor</group>
			<group>Secretary</group>
			<group>Director</group>
		</groups>
		<form name="Student SPN Request Form" alias="studentForm" fileName="wf-spn-student-form.html">
			<entity>
				<key>lastName</key>
				<label>Last Name</label>
				<type>String</type>
			</entity>
			<entity>
				<key>firstName</key>
				<label>firstName</label>
				<type>String</type>
			</entity>
			<entity>
				<key>midInit</key>
				<label>Middle Initial</label>
				<type>String</type>
			</entity>
			<entity>
				<key>ruid</key>
				<label>RUID</label>
				<type>String</type>
			</entity>
			<entity>
				<key>email</key>
				<label>Official Rutgers Email Only</label>
				<type>String</type>
			</entity>
			<entity>
				<key>gradDate</key>
				<label>Declared Graduation Date (month/year)</label>
				<type>String</type>
			</entity>
			<entity>
				<key>gpa</key>
				<label>Cumulative GPA</label>
				<type>number</type>
			</entity>
			<entity>
				<key>isSasHonors</key>
				<label>Are you a member of the School of Arts and Sciences Honors Program?</label>
				<type>boolean</type>
			</entity>
			<entity>
				<key>semYear</key>
				<label>Semester and Year</label>
				<type>String</type>
			</entity>
			<entity>
				<key>course</key>
				<label>Course (School # | Subject # | Course # | Section # | Index # | Credits | Title | Reasons for Taking)</label>
				<type>String</type>
			</entity>
			<entity>
				<key>instructorEmail</key>
				<label>Email of Rutgers Graduate Course Instructor</label>
				<type>String</type>
			</entity>
		</form>
		<form name="Instructor Form" alias="instructorForm" fileName="wf-spn-instructor-form.html">
			<entity>
				<key>instructorApproval</key>
				<label>Recommend Approval?</label>
				<type>boolean</type>
			</entity>
			<entity>
				<key>signature</key>
				<label>Instructor's Name</label>
				<type>String</type>
			</entity>
			<entity>
				<key>date</key>
				<label>Date</label>
				<type>Date</type>
			</entity>
		</form>
		<form name="Secretary Form" alias="secretaryForm" fileName="wf-spn-secretary-form.html">
			<entity>
				<key>spn</key>
				<label>SPN #</label>
				<type>String</type>
			</entity>
		</form>
		<form name="Director Form" alias="directorForm" fileName="wf-spn-director-form.html">
			<entity>
				<key>directorApproval</key>
				<label>Approved?</label>
				<type>boolean</type>
			</entity>
			<entity>
				<key>signature</key>
				<label>Graduate School Faculty Name</label>
				<type>String</type>
			</entity>
			<entity>
				<key>date</key>
				<label>Date</label>
				<type>Date</type>
			</entity>
		</form>

		<!-- Student creates new instance -->
		<event id="0.START">
			<!-- START is a condition keyword referring to the start event of an instance -->
			<condition>START</condition>
			<transitions>
				<!-- go to state 0 -->
				<transition>
					<condition>true</condition>
					<dest>0.FILE_REQUEST_FORM</dest>
				</transition>
			</transitions>
		</event>
		<state id="0.FILE_REQUEST_FORM">
			<condition>true</condition>
			<action>assign form studentForm to INSTANCE.CREATOR</action>
			<transitions>
				<transition>
					<condition>true</condition>
					<dest>1.REVIEW_FORM</dest>
				</transition>
			</transitions>
		</state>

		<state id="1.REVIEW_FORM">
		<!-- When student form is submitted -->
			<condition>studentForm._$.status == "submitted"</condition>
			<action>assign form instructorForm to studentForm.instructorEmail</action>
			<!-- When intructor form is submitted -->
			<condition>instructorForm._$.status == "submitted"</condition>
			<transitions>
				<transition>
					<condition>true</condition>
					<dest>2.SAVE_REQUEST_FORM</dest>
				</transition>
			</transitions>
		</state>

		<state id="2.SAVE_REQUEST_FORM">
			<condition>true</condition>
			<action>save studentForm+instructorForm</action>
			<transition>
				<condition>true</condition>
				<dest>2.ASSIGN_SPN</dest>
			</transition>
		</state>
		<state id="2.ASSIGN_SPN">
			<condition>true</condition>
			<action>assign form secretaryForm to USERS.secretary</action>
			<transitions>
				<transition>
					<condition>true</condition>
					<dest>2.RECEIVE_SIGNED_FORM</dest>
				</transition>
			</transitions>
		</state>

		<state id="2.RECEIVE_SIGNED_FORM">
			<condition>secretaryForm._$.status == "submitted"</condition>
			<transitions>
				<transition>
					<condition>true</condition>
					<dest>2.SAVE_FORM</dest>
				</transition>
			</transitions>
		</event>
		<state id="2.SAVE_FORM">
			<condition>true</condition>
			<action>save studentForm+instructorForm+secretaryForm+directorForm</action>
			<transitions>
				<transition>
					<condition>true</condition>
					<dest>3.SEND_TO_DIRECTOR</dest>
				</transition>
			</transitions>
		</state>

		<!-- When secretary form is submitted -->
		<state id="3.SEND_TO_DIRECTOR">
			<condition>directorForm._$.status == "submitted"</condition>
			<action>assign form directorForm to USERS.director</action>
		</state>
		
	</workflow>
</jown>