<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/index.html">

<dom-module id="registration-form">
  <template>
    <style>
      :host {
				display: block;
			}

			paper-card {
				min-width: 500px;
			}

			paper-card ::content .title-text {
				text-align: center;
			}

			paper-card .card-actions {
				text-align: right;
			}
    </style>

    <iron-ajax auto url="/users/allRoles" handle-as="json" debounce-duration="300" last-response="{{rolesList}}"></iron-ajax>

		<iron-ajax id="createUserAjax"
			url="/users/createUser"
			method="POST"
			handle-as="json"
			content-type="application/json"
			on-response="handleCreateUserResponse"></iron-ajax>

    <paper-dialog id="modal" modal alwaysOnTop="true">
        <p>Could not registers</p>
        <div class="buttons">
            <paper-button dialog-confirm autofocus>OK!</paper-button>
        </div>
    </paper-dialog>

    <paper-dialog id="dialog">
        <h2>Error!</h2>
        <p>Could not register</p>
    </paper-dialog>

    <paper-card id="login-form" heading="Register New Account">
    <div class="card-content">



    <paper-input label="Username" maxlength="100" value={{username}}></paper-input>
    <paper-input label="UserID" maxlength="100" value={{userId}}></paper-input>
    <paper-input label="Email" maxlength="100" value={{email}}></paper-input>
    <paper-input label="Password" type="password" maxlength="100" value={{password}}></paper-input>
    <paper-dropdown-menu class="dropdownmenu" label="Role">
      <paper-listbox class="dropdown-content">
        <template is="dom-repeat" items="[[rolesList]]">
          <paper-item class="items">{{item}}</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>
    <div class="card-actions">
      <paper-button flat on-tap="registerUser">Register</paper-button>
    </div>



    </div>
    </paper-card>
  </template>

  <script>
    Polymer({
      is: 'registration-form',

      properties: {
				username: String,
        userId: String,
        email: String,
				password: String,
				roles: Array
			},

      registerUser: function() {
        if (this.role === "username") {
          console.log("HI HELLO! NO ROLE!");
        }
        else {
          // alert("registering");"name", "email", "userId", "password", "roles"
          this.$.createUserAjax.body = {"userObj": {"name": this.username, "email": this.email, "userId": this.userId, "password": this.password,  "roles": "stoodent"}};
          this.$.createUserAjax.generateRequest();
        }
			},

      handleCreateUserResponse: function(request) {
				console.log(request.detail.response);
				console.log(this.$.createUserAjax.lastResponse);
        if(request.detail.response.success === "true") {
          console.log("LOGGING IN!");
        }
        else {
          console.log("LOG IN FAILED!");
        }
        alert("" + this.username);
        location.href = "/index.html";
			}
    });
  </script>
</dom-module>